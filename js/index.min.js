var x$;function import$(t,n){var e,i={}.hasOwnProperty;for(e in n)i.call(n,e)&&(t[e]=n[e]);return t}(x$=angular.module("servlet",["ldBase","backend"])).factory("httpRequestInterceptor",["global"].concat(function(n){return{request:function(t){return t.headers["X-CSRF-Token"]=n.csrfToken,t}}})),x$.config(["$compileProvider","$httpProvider"].concat(function(t,n){return t.aHrefSanitizationWhitelist(/^\s*(blob:|http:\/\/localhost)/),n.interceptors.push("httpRequestInterceptor")})),x$.controller("site",["$scope","$http","$interval","global","ldBase","ldNotify","initWrap"].concat(function(e,i,t,n,r,o,a){return a=a(),import$(e,r),e.notifications=o.queue,e.staticMode=n.static,e.$watch("user.data",function(t,n){if(t&&t.key)return e.track("uv/"+t.key,(new Date).toISOString().substring(0,10)+"",window.location.pathname),ga("set","dimension1",t.key)},!0),e.user={data:n.user},e.auth=a({init:function(){var t=this;return e.$watch("auth.ctrl.toggled",function(){return t.error={}})},email:"",displayname:"",passwd:"",stick:!1,subscribe:!0,config:{dismissOnEnter:!1,finish:function(){return e.auth.login()}},verify:function(){return this.error={},/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.[a-z]{2,}|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i.exec(this.email)?this.isSignIn||this.displayname&&!(this.displayname.length<3)?!this.passwd||this.passwd.length<4?this.error.passwd="it's too weak!":0:this.error.displayname="it's too short":this.error.email="this is not an email"},logout:function(){return console.log("logout.."),i({url:"/u/logout",method:"GET"}).success(function(t){return console.log("logouted."),e.user.data=null,window.location.reload()}).error(function(t){return o.send("danger","Failed to Logout. ")})},login:function(){var t,n=this;if(!this.verify())return this.loading=!0,t={newsletter:this.subscribe},i({url:this.isSignIn?"/u/login":"/u/signup",method:"POST",data:$.param(import$({email:this.email,passwd:this.passwd,displayname:this.displayname},this.isSignIn?{}:{config:t})),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).finally(function(){return n.loading=!1}).then(function(t){return e.user.data=t.data,ga("set","&uid",t.key),n.ctrl.toggle(!1),e.nexturl?window.location.href=e.nexturl:"/u/login"===window.location.pathname?window.location.href="/":void 0}).catch(function(t){return 403===t.status?n.isSignIn?n.error.passwd="wrong password":n.error.email="this email is used before.":n.error.email="system busy, try again later."}),this.passwd=""}}),a.run(),console.log("loaded")}));