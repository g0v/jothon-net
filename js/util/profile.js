function import$(t,e){var a={}.hasOwnProperty;for(var n in e)a.call(e,n)&&(t[n]=e[n]);return t}var profile,x$;profile=function(t,e,a){var n=this;return this.dom=t,this.data=e,a.monitor("user",function(t){return n.user=t,n.update(t)}),t["update.info"].addEventListener("click",function(){return n.updateInfo()}),t["update.passwd"].addEventListener("click",function(){return n.updatePasswd()}),t["jothon-app.create"].addEventListener("click",function(){return n.appCreate()}),$.ajax({url:"/d/me/jothon-app/",method:"GET"}).done(function(e){if(e.map(function(e){var a;return a=t["jothon-app.template"].cloneNode(!0),n.appDomUpdate(a,e)}),e.length)return helper.toggleClass(t["jothon-app.none"],"d-none",!0)})},x$=profile,x$.controller="profile",import$(x$.prototype,{running:function(t,e){return null==e&&(e=!0),helper.toggleClass(this.dom[t],"running",e)},update:function(t){var e=this;if(t)return["username","displayname","description"].map(function(a){if(t[a])return e.setText(a,t[a])}),["displayname","description","tags"].map(function(a){if(t[a])return e.set(a,t[a])}),["tags","website"].map(function(a){if((t.config||(t.config={}))[a])return e.set(a,t.config[a])}),this.dom.tags.innerHTML=(t.config||(t.config={})).tags.split(",").map(function(t){return"<div class='badge badge-light mr-1'>"+t+"</div>"}).join(""),this.dom.website.setAttribute("href",(t.config||(t.config={})).website||"#"),helper.toggleClass(this.dom.website,"d-none",!(t.config||(t.config={})).website)},updateInfo:function(){var t,e=this;if(this.user)return this.running("update.info"),$.ajaxSetup({headers:{"X-CSRF-Token":csrfToken}}),t={displayname:this.data.displayname,description:this.data.description,config:{website:this.data.website,tags:this.data.tags}},$.ajax({url:"/d/user/"+this.user.key,method:"PUT",data:t}).done(function(){return e.running("update.info",!1),e.update(import$(window.user,t))}).fail(function(){return alert("failed"),e.running("update.info",!1)})},updatePasswd:function(){var t,e=this;if(this.user)return this.data["password.new"]!==this.data["password.again"]?alert("password mismatch"):(this.running("update.passwd"),t={n:this.data["password.new"],o:this.data["password.now"]},$.ajax({url:"/d/me/passwd/",method:"PUT",data:t}).done(function(){return e.running("update.passwd",!1)}).fail(function(){return alert("failed"),e.running("update.passwd",!1)}))},appCreate:function(){var t,e=this;if(this.user)return this.data.appname&&this.data.appcb?(t={name:this.data.appname,callback:this.data.appcb,avatar:this.data.avatar},$.ajax({url:"/d/me/jothon-app/",method:"POST",data:t}).done(function(){return e.running("jothon-app.create",!1)}).fail(function(){return alert("failed"),e.running("jothon-app.create",!1)})):alert("information incomplete")},appDelete:function(t,e){var a=this;return this.user?$.ajax({url:"/d/me/jothon-app/"+e,method:"DELETE"}).done(function(){return alert("ok"),a.appDomUpdate(t,null,!0),helper.toggleClass(a.dom["jothon-app.none"],"d-none",!a.dom.root.querySelectorAll(".jothon-app").length)}).fail(function(){return alert("failed")}):alert("not logined")},appUpdate:function(t,e){var a,n=this;return this.user?t.name&&t.callback?(a={name:t.name,callback:t.callback,avatar:t.avatar},$.ajax({url:"/d/me/jothon-app/"+t.key,method:"PUT",data:a}).done(function(){return alert("ok"),n.appDomUpdate(e,t)}).fail(function(){return alert("failed")})):alert("information incomplete"):alert("not logined")},appDomUpdate:function(t,e,a){var n,r=this;return a?t.parentNode.removeChild(t):(helper.toggleClass(t,"d-none",!1),t.querySelector("h3").innerText=e.name,n=Array.from(t.querySelectorAll("input")),["name","callback","avatar","app_id","app_secret"].map(function(t,a){return n[a].value=e[t]}),e.avatar&&(t.querySelector(".avatar").style.backgroundImage="url("+e.avatar+")"),t.parentNode!==this.dom["jothon-app.list"]?(this.dom["jothon-app.list"].appendChild(t),t.querySelector(".jothon-app-update").addEventListener("click",function(){return["name","callback","avatar"].map(function(t,a){return e[t]=n[a].value}),r.appUpdate(e,t)}),t.querySelector(".jothon-app-delete").addEventListener("click",function(){return r.appDelete(t,e.key)}),t.querySelector(".jothon-secret-show").addEventListener("click",function(){return this.show=!this.show,t.querySelector(".secret").setAttribute("type",this.show?"text":"password"),this.innerText=this.show?"hide":"show"})):void 0)}});