var profile,x$;function import$(t,e){var a,n={}.hasOwnProperty;for(a in e)n.call(e,a)&&(t[a]=e[a]);return t}(x$=profile=function(a,t,e){var n=this;return this.dom=a,this.data=t,e.monitor("user",function(t){return n.user=t,n.update(t)}),a["update.info"].addEventListener("click",function(){return n.updateInfo()}),a["update.passwd"].addEventListener("click",function(){return n.updatePasswd()}),a["jothon-app.create"].addEventListener("click",function(){return n.appCreate()}),$.ajax({url:"/d/me/jothon-app/",method:"GET"}).done(function(t){if(t.map(function(t){var e=a["jothon-app.template"].cloneNode(!0);return n.appDomUpdate(e,t)}),t.length)return helper.toggleClass(a["jothon-app.none"],"d-none",!0)})}).controller="profile",import$(x$.prototype,{running:function(t,e){return null==e&&(e=!0),helper.toggleClass(this.dom[t],"running",e)},update:function(e){var a=this;if(e)return["username","displayname","description"].map(function(t){if(e[t])return a.setText(t,e[t])}),["displayname","description","tags"].map(function(t){if(e[t])return a.set(t,e[t])}),["tags","website"].map(function(t){if((e.config||(e.config={}))[t])return a.set(t,e.config[t])}),this.dom.tags.innerHTML=(e.config||(e.config={})).tags.split(",").map(function(t){return"<div class='badge badge-light mr-1'>"+t+"</div>"}).join(""),this.dom.website.setAttribute("href",(e.config||(e.config={})).website||"#"),helper.toggleClass(this.dom.website,"d-none",!(e.config||(e.config={})).website)},updateInfo:function(){var t,e=this;if(this.user)return this.running("update.info"),$.ajaxSetup({headers:{"X-CSRF-Token":csrfToken}}),t={displayname:this.data.displayname,description:this.data.description,config:{website:this.data.website,tags:this.data.tags}},$.ajax({url:"/d/user/"+this.user.key,method:"PUT",data:t}).done(function(){return e.running("update.info",!1),e.update(import$(window.user,t))}).fail(function(){return alert("failed"),e.running("update.info",!1)})},updatePasswd:function(){var t,e=this;if(this.user)return this.data["password.new"]!==this.data["password.again"]?alert("password mismatch"):(this.running("update.passwd"),t={n:this.data["password.new"],o:this.data["password.now"]},$.ajax({url:"/d/me/passwd/",method:"PUT",data:t}).done(function(){return e.running("update.passwd",!1)}).fail(function(){return alert("failed"),e.running("update.passwd",!1)}))},appCreate:function(){var t,e=this;if(this.user)return this.data.appname&&this.data.appcb?(t={name:this.data.appname,callback:this.data.appcb,avatar:this.data.avatar},$.ajax({url:"/d/me/jothon-app/",method:"POST",data:t}).done(function(){return e.running("jothon-app.create",!1)}).fail(function(){return alert("failed"),e.running("jothon-app.create",!1)})):alert("information incomplete")},appDelete:function(t,e){var a=this;return this.user?$.ajax({url:"/d/me/jothon-app/"+e,method:"DELETE"}).done(function(){return alert("ok"),a.appDomUpdate(t,null,!0),helper.toggleClass(a.dom["jothon-app.none"],"d-none",!a.dom.root.querySelectorAll(".jothon-app").length)}).fail(function(){return alert("failed")}):alert("not logined")},appUpdate:function(t,e){var a,n=this;return this.user?t.name&&t.callback?(a={name:t.name,callback:t.callback,avatar:t.avatar},$.ajax({url:"/d/me/jothon-app/"+t.key,method:"PUT",data:a}).done(function(){return alert("ok"),n.appDomUpdate(e,t)}).fail(function(){return alert("failed")})):alert("information incomplete"):alert("not logined")},appDomUpdate:function(t,a,e){var n,r=this;return e?t.parentNode.removeChild(t):(helper.toggleClass(t,"d-none",!1),t.querySelector("h3").innerText=a.name,n=Array.from(t.querySelectorAll("input")),["name","callback","avatar","app_id","app_secret"].map(function(t,e){return n[e].value=a[t]}),a.avatar&&(t.querySelector(".avatar").style.backgroundImage="url("+a.avatar+")"),t.parentNode!==this.dom["jothon-app.list"]?(this.dom["jothon-app.list"].appendChild(t),t.querySelector(".jothon-app-update").addEventListener("click",function(){return["name","callback","avatar"].map(function(t,e){return a[t]=n[e].value}),r.appUpdate(a,t)}),t.querySelector(".jothon-app-delete").addEventListener("click",function(){return r.appDelete(t,a.key)}),t.querySelector(".jothon-secret-show").addEventListener("click",function(){return this.show=!this.show,t.querySelector(".secret").setAttribute("type",this.show?"text":"password"),this.innerText=this.show?"hide":"show"})):void 0)}});