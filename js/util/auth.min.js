var auth,x$;function import$(n,t){var i,e={}.hasOwnProperty;for(i in t)e.call(t,i)&&(n[i]=t[i]);return n}(x$=auth=function(n,t,i){var e=this;return this.mode=0,this.parent=i,n["tab.signup"].addEventListener("click",function(){return e.tab("signup")}),n["tab.login"].addEventListener("click",function(){return e.tab("login")}),n.action.addEventListener("click",function(){return e.signin(0===e.mode)}),n.closebtn.addEventListener("click",function(){return i.fire("authpanel.off")}),i.monitor("signout",function(){return e.signout()})}).controller="auth",import$(x$.prototype,{tab:function(n){var t=["signup","login"],i=["註冊 / Sign Up","登入 / Login"];return this.mode=n=t.indexOf(n),helper.addClass(this.dom["tab."+t[n]],"active"),helper.removeClass(this.dom["tab."+t[1-n]],"active"),this.setText("action",i[n]),this.dom.displayname.style.display=n?"none":"block",this.dom.newsletter.style.display=n?"none":"block"},error:function(n,t){return this.setText("error."+n,t),helper.addClass(this.dom.model[n],"is-invalid"),this.running(!1)},running:function(n){return null==n&&(n=!0),helper.addClass(this.dom.action,"running"),helper.removeClass(this.dom.action,"running"),helper.toggleClass(this.dom.action,"running",n)},signout:function(){var n=this;return $.ajax({url:"/u/logout",method:"GET"}).done(function(){return n.parent.fire("signout.done")})},signin:function(t){var i=this;return null==t&&(t=!0),["email","displayname","passwd"].map(function(n){return helper.removeClass(i.dom.model[n],"is-invalid")}),/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.[a-z]{2,}|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i.exec(this.data.email)?t&&!this.data.displayname?this.error("displayname","這個欄位為必填"):this.data.passwd?this.data.passwd.length<4?this.error("passwd","密碼太弱"):(this.running(),$.ajax({url:t?"/u/signup":"/u/login",method:"POST",data:this.data}).done(function(n){return i.parent.fire("authpanel.off"),i.parent.fire("signin",n),/\/openid\/i/.exec(window.location.pathname)?window.location.href=window.location.pathname+"":i.running(!1)}).fail(function(n){return 403===n.status?t?i.error("email","已經註冊過了"):i.error("passwd","密碼不符"):i.error("email","系統問題，請稍候再試")})):this.error("passwd","這個欄位為必填"):this.error("email","這不是電子郵件")}});